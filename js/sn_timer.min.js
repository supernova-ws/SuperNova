if(window.LOADED_TIMER===undefined){var LOADED_TIMER=true;var UNIT_ID=0;var UNIT_NAME=1;var UNIT_TIME=2;var UNIT_AMOUNT=3;var UNIT_LEVEL=4;var UNIT_TIME_FULL=5;var EVENT_TIME=0;var EVENT_STRING=1;var EVENT_HINT=2;var TIMER_BUILD_QUE_V1=0;var TIMER_COUNTER=1;var TIMER_BUILD_QUE_V2=3;var TIMER_CLOCK_REALTIME=4;var TIMER_EVENT_QUE=5;var sn_timers=new Array();var timer_is_started=false;var timer_is_prepared=false;function sn_timer_prepare(){var c,b,a;if(timer_is_prepared){return}for(b in sn_timers){if(!sn_timers.hasOwnProperty(b)){continue}c=sn_timers[b];c.start_time=timeTimerStart;if(c.type===undefined){c.active=false;continue}c.active=true;c.prefixClass="."+c.id;c.prefixId="#"+c.id;c.html_main=$(c.prefixId);c.options===undefined?c.options={}:false;a=c.options;c.type=parseInt(c.type);switch(c.type){case TIMER_BUILD_QUE_V1:c.html_timer=$(c.prefixId+"_timer");if(!c.html_main.length&&!c.html_timer.length){c.active=false;break}c.always_refresh=c.html_main.length&&!c.html_timer.length;c.changed=true;break;case TIMER_BUILD_QUE_V2:if(!a.que.length){if(a.url!==undefined){document.location=a.url}c.active=false;break}c.slotAmountBarWidthLast=0;c.unit_amount_original=a.que[0][UNIT_AMOUNT];c.html_total_js=$(c.prefixId+"_total:visible");c.html_que_js=$(c.prefixId+"_que");c.html_finish=$(c.prefixId+"_finish:visible");c.html_slots_current=$(c.prefixId+"_slots");c.html_queProgressBar=$(c.prefixId+"_progress_bar");c.queProgressBarWidth=c.html_queProgressBar.width()?c.html_queProgressBar.width():0;c.html_level_current=$(c.prefixClass+"_level_0:visible");c.html_slotUnitTimeBar=$(c.prefixClass+"_unit_bar_0:visible");c.slotUnitTimeBarWidth=c.html_slotUnitTimeBar.parent().width()?c.html_slotUnitTimeBar.parent().width():0;c.html_timer_current=$(c.prefixClass+"_timer_0:visible");c.slotUnitTimeBarWidthCurrent=-1;c.slotAmountBarWidthCurrent=-1;c.queProgressBarWidthCurrent=-1;c.que_compiled="";break;case TIMER_EVENT_QUE:c.html_total_js=$(c.prefixId+"_total:visible");if(!c.html_main.length&&!c.html_total_js.length){c.active=false;break}c.changed=true;break;case TIMER_COUNTER:if(c.html_main.length<=0){c.active=false;break}a.round=a.round===undefined?0:parseInt(a.round);a.start_value=a.start_value===undefined?0:parseInt(a.start_value);a.per_second=a.per_second===undefined?0:parseFloat(a.per_second);break;case TIMER_CLOCK_REALTIME:if(c.html_main.length<=0){c.active=false;break}a.format=parseInt(a.format===undefined?a:a.format);a.delta=a.delta===undefined?0:parseInt(a.delta);break;default:c.active=false;break}}timer_is_prepared=true}function sn_timer_compile_que(h){var e=h.options;var g=e.que;var f="";var d=0;var b,c;var a=h.html_que_js.is(":not(:visible)");for(c in g){if(!g.hasOwnProperty(c)){continue}d+=(g[c][UNIT_AMOUNT]-(c==0?1:0))*g[c][UNIT_TIME_FULL];if(a){continue}b=g[c][g[c][UNIT_LEVEL]>0?UNIT_LEVEL:UNIT_AMOUNT];f+=e.template.replace(/\[UNIT_ID\]/gi,g[c][UNIT_ID]).replace(/\[UNIT_TIME\]/gi,sn_timestampToString(g[c][UNIT_TIME])).replace(/\[UNIT_LEVEL\]/gi,b).replace(/\[UNIT_NAME\]/gi,g[c][UNIT_NAME]).replace(/\[UNIT_QUE_PLACE\]/gi,c)}e.total=d;!e.total_original?e.total_original=e.total:false;return f}function sn_timer(){if(timer_is_started){window.setTimeout("sn_timer();",1000);return}timer_is_started=true;sn_timer_prepare();var b,k,n,l,g,j,c,m,d,i,f,e;var a=0;var h=new Date();for(k in sn_timers){if(!sn_timers.hasOwnProperty(k)||!sn_timers[k]["active"]){continue}l="";c="";b=sn_timers[k];g=b.options;f=Math.round((h.valueOf()-b.start_time.valueOf())/1000);switch(b.type){case TIMER_BUILD_QUE_V1:e=g.que;if(e.length){if(e[0][UNIT_TIME]<=f){b.start_time=h;e[0][UNIT_AMOUNT]--;if(e[0][UNIT_AMOUNT]<=0){e.shift();b.changed=true}}}if(e.length&&e[0][UNIT_ID]){l=e[0][UNIT_NAME]+(e[0][UNIT_LEVEL]?" ("+(e[0][UNIT_LEVEL])+")":"");f=Math.round((h.valueOf()-b.start_time.valueOf())/1000);c=sn_timestampToString(-(f)+parseInt(e[0][UNIT_TIME]))}else{l=g.msg_done;b.changed=true;b.active=false}if(b.html_timer.length){b.html_timer.text(c)}else{l+=(l&&c?"<br>":"")+c}if((b.always_refresh||b.changed)&&b.html_main.length){b.html_main.html(l)}break;case TIMER_BUILD_QUE_V2:b.start_time=h;e=g.que;e[0][UNIT_TIME]-=f;if(e[0][UNIT_TIME]<=0){f=-e[0][UNIT_TIME];e[0][UNIT_AMOUNT]--;if(e[0][UNIT_AMOUNT]<=0){e.shift();b.que_compiled=""}else{e[0][UNIT_TIME]=e[0][UNIT_TIME_FULL];g.total-=e[0][UNIT_TIME_FULL];b.html_level_current.text(e[0][UNIT_AMOUNT]);b.slotAmountBarWidthCurrent=Math.percentPixels(e[0][UNIT_AMOUNT],b.unit_amount_original,b.slotUnitTimeBarWidth)}}else{f=0}if(!b.que_compiled){b.que_compiled=sn_timer_compile_que(b);b.html_slots_current.length?b.html_slots_current.html(e.length):false;b.html_que_js.length?b.html_que_js.html(b.que_compiled):false;b.html_level_current=$(b.prefixClass+"_level_0:visible");b.html_timer_seconds=$(b.prefixClass+"_seconds_0:visible");b.html_timer_current=$(b.prefixClass+"_timer_0:visible");b.html_slotUnitTimeBar=$(b.prefixClass+"_unit_bar_0:visible");b.slotUnitTimeBarWidth=b.html_slotUnitTimeBar.parent().width()?b.html_slotUnitTimeBar.parent().width():0;b.html_slotAmountBar=$(b.prefixClass+"_slot_bar_0:visible")}if(e.length&&e[0][UNIT_ID]){e[0][UNIT_TIME]-=f;i=e[0][UNIT_TIME]<=0?1:e[0][UNIT_TIME];l=e[0][UNIT_NAME]+" ("+e[0][e[0][UNIT_LEVEL]?UNIT_LEVEL:UNIT_AMOUNT]+")";c=sn_timestampToString(i);n=sn_timestampToString(i+g.total);if(!b.html_finish.already_tagged&&b.html_finish.length){b.html_finish.html(snDateToString(new Date(timeBrowser.valueOf()+(i+g.total)*1000),7));b.html_finish.already_tagged=true}b.slotUnitTimeBarWidthCurrent=Math.percentPixels(i,e[0][UNIT_TIME_FULL],-b.slotUnitTimeBarWidth);b.queProgressBarWidthCurrent=Math.percentPixels(i+g.total,e[0][UNIT_TIME_FULL]+g.total_original,b.queProgressBarWidth)}else{if(g.url!==undefined){document.location=g.url}i=0;l=g.msg_done;$(b.prefixClass+"_hide_on_complete").hide();b.active=false}b.html_timer_seconds.length?b.html_timer_seconds.width(Math.round((i%60+1)/60*100)+"%"):false;if(b.html_total_js.length){b.html_total_js.html(n)}else{c+=(c?"<br>":"")+n}if(b.html_timer_current.length){b.html_timer_current.html("<span>"+c+"</span>")}else{l+=(l&&c?"<br>":"")+c}if(!PLAYER_OPTION_PROGRESS_BARS_DISABLED){if(b.html_queProgressBar.length&&b.queProgressBarWidthCurrent!=b.queProgressBarWidthLast){b.html_queProgressBar.css("width",b.queProgressBarWidthLast=b.queProgressBarWidthCurrent)}if(b.html_slotUnitTimeBar.length&&b.slotUnitTimeBarWidthCurrent!=b.slotUnitTimeBarWidthLast){b.html_slotUnitTimeBar.css("width",b.slotUnitTimeBarWidthLast=b.slotUnitTimeBarWidthCurrent)}if(b.html_slotAmountBar.length&&b.slotAmountBarWidthCurrent!=b.slotAmountBarWidthLast){b.html_slotAmountBar.css("width",b.slotAmountBarWidthLast=b.slotAmountBarWidthCurrent)}}if(!jQuery.fx.off&&e.length){if(e[0][UNIT_TIME]==1&&e[0][UNIT_AMOUNT]==1){$(b.prefixClass+"_container_0:visible").animate({opacity:0},e[0][UNIT_TIME]*1000)}if(e[0][UNIT_TIME_FULL]==i){b.html_timer_current.children().animate({opacity:0},50,function(){$(this).animate({opacity:1},300)})}}b.html_main.length&&l!=b.infoText?b.html_main.html(b.infoText=l):false;break;case TIMER_EVENT_QUE:d="";if(g.que.length&&g.que[0][EVENT_TIME]<=f){g.que.shift();b.changed=true}if(g.que.length){if(b.changed){l=g.que[0][EVENT_STRING];d=g.que[0][EVENT_HINT]}}else{l=g.msg_done;b.changed=true;b.active=false}if(b.changed){b.html_main.length?b.html_main.html(l):false;b[b.html_total_js.length?"html_total_js":"html_main"].prop("title",d);b.changed=false}break;case TIMER_COUNTER:if(g.per_second==0){m=g.start_value;b.active=false}else{m=g.start_value+f*g.per_second;if(m<0){m=0;b.active=false}else{if(m>=g.max_value&&g.per_second>0){m=Math.max(g.start_value,g.max_value);b.active=false}}}l=sn_format_number(m,g.round,"positive",g.max_value);b.html_main.html(l);break;case TIMER_CLOCK_REALTIME:j=new Date(h.valueOf()+g.delta*1000);b.html_main.html(snDateToString(j,g.format));break}a++}if(a){window.setTimeout("sn_timer();",1000)}timer_is_started=false}};