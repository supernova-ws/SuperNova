var C_SHIP_NAME=0,C_SHIP_AMOUNT=1,C_SHIP_SPEED=2,C_SHIP_CONSUMPTION=3,C_SHIP_CAPACITY=4;var C1_SHIP_NAME=0,C1_SHIP_AMOUNT=0,C1_SHIP_SPEED=1,C1_SHIP_CONSUMPTION=2,C1_SHIP_CAPACITY=3;var prev_mission=0;function changeMission(c){if($(c).val()==prev_mission){return}prev_mission=$(c).val();jQuery("img.mission_button_image.button_pseudo_pressed").removeClass("button_pseudo_pressed");var b=jQuery("#mission_button"+prev_mission);b.addClass("button_pseudo_pressed");var a=$("#fleet_mini_mission");a.length?a.find("span").text(b.parent().find("#mission_name").text()):false;switch(prev_mission){case"1":case"2":case"5":case"6":case"8":case"9":case"10":case"15":jQuery("#resTable").hide();jQuery("#resource0").val(0).trigger("change");jQuery("#resource1").val(0).trigger("change");jQuery("#resource2").val(0).trigger("change");break;default:jQuery("#resTable").show();break}if(prev_mission==15){jQuery(".fleet_expedition_warning").show()}else{jQuery(".fleet_expedition_warning").hide()}}function speed_percent(){var a=document.getElementsByName("speed");return a.length?a[0].value:10}function setTarget(c,d,b,a){document.getElementsByName("galaxy")[0].value=c;document.getElementsByName("system")[0].value=d;document.getElementsByName("planet")[0].value=b;document.getElementsByName("planet_type")[0].value=a;$("#end_coords").html("["+c+":"+d+":"+b+"]");$("#end_planet_type").html(planet_types[a]);planet_name=planet_names["g"+c+"s"+d+"p"+b+"t"+a];$("#end_name").html(planet_name?planet_name:"");shortInfo();return false}function setMission(a){document.getElementsByName("order")[0].selectedIndex=a;return}function setACS(a){$("#fleet_group").val(a)}function setACS_target(a){document.getElementsByName("acs_target_mr")[0].value=a;return}function min(d,c){d=d*1;c=c*1;if(d>c){return c}else{return d}}function distance(){var e;var c;var a;var f;var d;var b;var g=0;f=document.getElementsByName("galaxy")[0].value;d=document.getElementsByName("system")[0].value;b=document.getElementsByName("planet")[0].value;e=document.getElementsByName("thisgalaxy");if(e.length){e=document.getElementsByName("thisgalaxy")[0].value;c=document.getElementsByName("thissystem")[0].value;a=document.getElementsByName("thisplanet")[0].value;if((f-e)!=0){g=Math.abs(f-e)*UNIVERSE_GALAXY_DISTANCE}else{if((d-c)!=0){g=Math.abs(d-c)*5*19+2700}else{if((b-a)!=0){g=Math.abs(b-a)*5+1000}else{g=5}}}}else{g=UNIVERSE_GALAXY_DISTANCE}return(g)}function duration(){ret=Math.round(((35000/speed_percent()*Math.sqrt(distance()*10/fleet_speed)+10)/speed_factor));return ret}function consumption(){var a=0;var c=speed_percent()*Math.sqrt(fleet_speed);for(var b in ships){shipcount=ships[b][C1_SHIP_AMOUNT];shipspeed=ships[b][C1_SHIP_SPEED];shipconsumption=ships[b][C1_SHIP_CONSUMPTION];a+=shipconsumption*shipcount*(c/Math.sqrt(shipspeed)/10+1)*(c/Math.sqrt(shipspeed)/10+1)}a=Math.round(distance()*a/35000)+1;return(a)}function shortInfo(){jQuery("#distance").html(sn_format_number(distance()));var e=duration();var d=e*1000;if(e){var b=Math.floor(e/3600);e-=b*3600;var c=Math.floor(e/60);e-=c*60;if(b<10){b="0"+b}if(c<10){c="0"+c}if(e<10){e="0"+e}jQuery("#duration").html(b+":"+c+":"+e);time_temp_local=new Date();time_temp_local.setTime(time_temp_local.valueOf()+d);jQuery("#time_dst_local").html(time_temp_local.toLocaleString());time_temp=new Date(time_temp_local.valueOf()-timeDiff*1000);jQuery("#time_dst").html(time_temp.toLocaleString());time_temp_local.setTime(time_temp_local.valueOf()+d);jQuery("#time_src_local").html(time_temp_local.toLocaleString());time_temp.setTime(time_temp.valueOf()+d);jQuery("#time_src").html(time_temp.toLocaleString())}else{jQuery("#duration").html("-")}var a=consumption();jQuery("#consumption").html(sn_format_number(a,0,"positive"));jQuery("#capacity").html(sn_format_number(fleet_capacity-a,0,"positive"))}var fleet_consumption=0;var fleet_capacity=0;var fleet_speed=Infinity;function fl_calc_stats(c,d){if(fleet_global_update){return}fleet_consumption=0;fleet_capacity=0;fleet_speed=Infinity;var a=Array();for(i in ships){a[i]=jQuery("#ships"+i+"slide").slider("value");if(a[i]!=0){fleet_speed=Math.min(fleet_speed,ships[i][C1_SHIP_SPEED]);fleet_capacity+=a[i]*ships[i][C1_SHIP_CAPACITY]}}var b=speed_percent()*Math.sqrt(fleet_speed);for(i in ships){if(a[i]!=0){fleet_consumption+=ships[i][C1_SHIP_CONSUMPTION]*a[i]*(b/Math.sqrt(ships[i][C1_SHIP_SPEED])/10+1)*(b/Math.sqrt(ships[i][C1_SHIP_SPEED])/10+1)}}fleet_consumption=Math.round(distance()*fleet_consumption/35000)+1;if(fleet_capacity>0){fleet_capacity-=fleet_consumption}else{fleet_consumption=0}document.getElementById("int_fleet_capacity").innerHTML=sn_format_number(fleet_capacity);document.getElementById("int_fleet_consumption").innerHTML=sn_format_number(fleet_consumption);document.getElementById("int_fleet_speed").innerHTML=fleet_speed==Infinity?"-":sn_format_number(fleet_speed);shortInfo()}function calculateTransportCapacity(){var a=fleet_capacity-check_resource(0)-check_resource(1)-check_resource(2);$("#remainingresources").html(sn_format_number(a,0,"positive"));$("#fleet_page2_submit").prop("disabled",a<0);if(a<0){$(".fleet_expedition_not_enough_fuel").show()}else{$(".fleet_expedition_not_enough_fuel").hide()}return a}function setNumber(a,b){if(typeof document.getElementsByName("ship"+a)[0]!="undefined"){document.getElementsByName("ship"+a)[0].value=b}}function abs(b){return b<0?-b:b}var fleet_global_update=false;function zero_fleet(){fleet_global_update=true;jQuery('[id^="ships"][id$="slide"]').slider("value",0);fleet_global_update=false;fl_calc_stats()}function expe_fleet(a){if(a>1){fleet_global_update=true;jQuery('[id^="ships"][id$="slide"]').each(function(){jQuery(this).slider("value",Math.floor(jQuery(this).slider("option","max")/a))});fleet_global_update=false;fl_calc_stats()}}function max_fleet(){fleet_global_update=true;jQuery('[id^="ships"][id$="slide"]').each(function(){jQuery(this).slider("value",jQuery(this).slider("option","max"))});fleet_global_update=false;fl_calc_stats()}function check_resource(b){var a=parseInt($("#resource"+b).val());a=a?a:0;$("#rest_res"+b).html(sn_format_number(resource_max[b]-a,0,"zero"));return a}function zero_resource(a){element=document.getElementsByName("resource"+a)[0];if(element){element.value=0;jQuery("#resource"+a).trigger("change")}calculateTransportCapacity()}function zero_resources(){for(i in resource_max){zero_resource(i)}calculateTransportCapacity()}function max_resource(c){if(document.getElementsByName("resource"+c)[0]){var a=Math.max(fleet_capacity-check_resource(0)-check_resource(1)-check_resource(2),0);var b=Math.min(a+check_resource(c),resource_max[c]);document.getElementsByName("resource"+c)[0].value=b;jQuery("#resource"+c).trigger("change");calculateTransportCapacity()}}function max_resources(){for(var a in resource_max){max_resource(a)}calculateTransportCapacity()}function fleet_dialog_show(b,a){popup_show(fleet_table_make(a),{my:"left top",at:"right top",of:b})}function fleet_table_make(a){if(!fleets[a]){return""}if(!fleets[a][9]){var f='<table class="no_border_image"><tr><td class="c" colspan="2">'+language.sys_fleet_composition+"</td></tr>";var d=fleets[a][0];var g=fleets[a][1];var e,h;var b=0;for(e in d){if(!d.hasOwnProperty(e)){continue}f+='<tr><td class="c_l">';f+=d[e][C_SHIP_NAME];f+='</td><td class="c_r">'+sn_format_number(parseInt(d[e][C_SHIP_AMOUNT]));f+="</td></tr>";b+=d[e][C_SHIP_CAPACITY]*d[e][C_SHIP_AMOUNT]}if(b){f+='<tr><td class="c">'+language.sys_capacity+'</td><td class="c" style="padding-right: 3px;">'+sn_format_number(b,0,"zero")+"</td></tr>"}var c=parseInt(g[0])+parseInt(g[1])+parseInt(g[2]);if(c>0){for(h in g){if(!g.hasOwnProperty(h)||!parseInt(g[h])){continue}f+='<tr><th class=c><div style="text-align: left">'+res_names[h]+'</div></th><th><div style="text-align: right;">'+sn_format_number(parseInt(g[h]),0,"zero")+"</div></th></tr>"}f+="<tr><td class=c>"+language.sys_resources+'</td><td class=c style="text-align: right; padding-right: 3px;">'+sn_format_number(c,0,"zero")+"</td></tr>"}f+="</table>";fleets[a][9]=f}return(fleets[a][9])}function fleet_page_2_loaded(){mission_checked=0;$("[name='target_mission']:checked").each(function(){mission_checked=$(this)});if(!mission_checked){mission_checked=$("[name='target_mission']:first");mission_checked.attr("checked",1)}changeMission(mission_checked);calculateTransportCapacity()}function fleet_page_2_prepare_slider(c,b,a){sn_ainput_make("resource"+c,{max:Math.min(b,a),step:1000,button_max:true,button_zero:true});jQuery("#resource"+c).on("keyup change",function(d,e){calculateTransportCapacity()});jQuery("#resource"+c+"slide").on("slide slidechange",function(e,f){if(fleet_slide_changing){return}else{fleet_slide_changing=true}var d=a-check_resource(0)-check_resource(1)-check_resource(2);for(i=0;i<3;i++){aSlider=jQuery("#resource"+i+"slide");aSlider.slider("option","max",Math.min(aSlider.slider("value")+d,resource_max[i]));jQuery("#resource"+i).change()}fleet_slide_changing=false})};