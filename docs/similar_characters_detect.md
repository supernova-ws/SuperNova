# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –Ω–∞ –≤–∏–∑—É–∞–ª—å–Ω—É—é –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å –≤ PHP

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –≤–∏–∑—É–∞–ª—å–Ω–æ –ª–∏ –¥–≤–µ —Å—Ç—Ä–æ–∫–∏ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã, –≤ PHP –Ω–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è —Å—Ä–∞–∑—É —Ä–µ—à–∞–µ—Ç –≤—Å–µ –∫–µ–π—Å—ã. –ù–æ –µ—Å—Ç—å –ø–æ–¥—Ö–æ–¥—ã –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏.

---

## 1Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é + grapheme

```php
function normalizeString(string $s): string {
    if (class_exists('Normalizer')) {
        $s = Normalizer::normalize($s, Normalizer::FORM_C);
    }
    return $s;
}

function visuallyEqualBase(string $a, string $b): bool {
    $a = normalizeString($a);
    $b = normalizeString($b);
    return grapheme_strlen($a) === grapheme_strlen($b)
        && grapheme_strtolower($a) === grapheme_strtolower($b);
}
```

> –£–ª—É—á—à–∞–µ—Ç –æ–±—ã—á–Ω–æ–µ `===`, –Ω–æ –Ω–µ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –ø–æ—Ö–æ–∂–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö.

---

## 2Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É Unicode Confusables

Unicode –ø—É–±–ª–∏–∫—É–µ—Ç —Ç–∞–±–ª–∏—Ü—ã –ø–æ—Ö–æ–∂–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ (confusable characters). –ò—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∑–∞–º–µ–Ω—ã –≤—Å–µ—Ö —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–æ–≤ –Ω–∞ –±–∞–∑–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã.

### üì¶ Composer-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏

* **voku/portable-utf8**
* **patchwork/utf8**
* **symfony/string**

–≠—Ç–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —É–º–µ—é—Ç:

* –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å Unicode (NFC/NFD)
* –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å –ø–æ—Ö–æ–∂–∏–µ —Å–∏–º–≤–æ–ª—ã
* –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –≥—Ä–∞—Ñ–µ–º—ã

### –ü—Ä–∏–º–µ—Ä —Å voku/portable-utf8

```php
use function voku\helper\UTF8;

function visuallyIdenticalUtf8(string $a, string $b): bool {
    $a = UTF8::normalize($a);
    $b = UTF8::normalize($b);

    $a = UTF8::remove_bom($a);
    $b = UTF8::remove_bom($b);

    $a = UTF8::to_lower($a);
    $b = UTF8::to_lower($b);

    return $a === $b;
}
```

### Symfony String (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Symfony)

```php
use Symfony\Component\String\u;

if (u($str1)->folded()->toString() === u($str2)->folded()->toString()) {
    echo "Visually same";
}
```

`.folded()` —É–±–∏—Ä–∞–µ—Ç –¥–∏–∞–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–ª–∏—á–∏—è –∏ –¥–µ–ª–∞–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º.

---

## üîπ –ò—Ç–æ–≥

| –ü–æ–¥—Ö–æ–¥             | Unicode –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è | –ü–æ—Ö–æ–∂–∏–µ —Å–∏–º–≤–æ–ª—ã | –õ–µ–≥–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
| ------------------ | -------------------- | --------------- | ------------------ |
| –ü—Ä–æ—Å—Ç—ã–µ replace    | ‚ùå                    | ‚ùå               | ‚úÖ                  |
| intl + grapheme    | ‚úîÔ∏è                   | ‚ùå               | ‚ö†Ô∏è                 |
| voku/portable-utf8 | ‚úîÔ∏è                   | ‚úîÔ∏è              | ‚úîÔ∏è                 |
| symfony/string     | ‚úîÔ∏è                   | ‚úîÔ∏è              | ‚úîÔ∏è                 |

> –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≤–∏–∑—É–∞–ª—å–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `voku/portable-utf8` –∏–ª–∏ `symfony/string`.

---

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –≥–æ—Ç–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏—é —Å **Unicode confusables** –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.
