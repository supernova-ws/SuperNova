Проект "Сверхновая"
~~~~~~~~~~~~~~~~~~~
"Сверхновая"  (далее  -  СН)  -  многопользовательская  браузерная  космическая
стратегия, клон oGame. СН базируется на XNova RageRepack v.226 (далее RR).

Disclaimer aka Отмазка
======================
ВНИМАНИЕ! Проект находится в стадии  альфа-версии!  В  настоящее  время  он  не
предназначен для  production-использования!  Код  предоставляется  "as-is".  Вы
используете его на свой  страх  и  риск!  Автор  не  несет  ответственности  за
материальный,  моральный,  кармический,  душевный   и   любой   другой   ущерб,
причиненный вам от использования, неиспользования, самим  фактом  существования
этого кода или любым другим способом.

ВНИМАНИЕ! Хотя СН является клоном оГейм, она НЕ ЯВЛЯЕТСЯ ОФФЛАЙК!  Т.е.  многие
аспекты игры отличаются как  от  официального  оГейма,  так  и  от  RR.  Движок
изменен, что бы соответствовать моему пониманию об интересной игре.  Принимайте
это во внимание, когда решаете - устанавливать этот движок себе или нет.

ВНИМАНИЕ! Статус проекта "Сверхновая" - альфа-версия. Практически это означает,
что очередной апдейт может полностью изменить отдельный аспект игры.

Примерный план развития движка содержится в файле docs/changelog.todo

Код распространяется под лицензией GNU GENERAL PUBLIC  LICENSE  Version  2,
June 1991. Сама  лицензия  находится  в  файле  docs/license.txt  дистрибутива.
Доолнение к лицензии: движок является полностью бесплатным  до  тех  пор,  пока
сохраняются мои копирайты. Так же вы не имеете права  продавать  сам  движок  и
любые продукты на его основе (однако имеете право взимать  плату  за  доступ  к
игре и/или продавать внутриигровые ресурсы).

Проект "Сверхновая" в интернете
===============================

GitHub
------
GitHub используется как основное хранилище кода в интернете. На нем вы  найдете
самую последнюю версию Сверхновой

"Сверхновая" на GitHub:
  http://github.com/supernova-ws/SuperNova

GIT-репозиторий:
  git://github.com/supernova-ws/SuperNova.git

Он же по HTTP:
  https://github.com/supernova-ws/SuperNova#

Ссылка на архив:
  https://github.com/supernova-ws/SuperNova/archives/master

SVN-интерфейс к репозиторию:
  http://svn.github.com/supernova-ws/SuperNova.git
ПРИМЕЧАНИЕ: SVN-интерфейс работает КРАЙНЕ  нестабильно.  Поэтому  исходники  по
этому адресу  могут  быть  недоступны.  Используйте  любую  другую  из  ссылок,
приведенных выше или ниже

В репозитории есть три ветки.
Ветка "master" содержит последний стабильный релиз движка плюс самые актуальные
багфиксы. Перед выкладыванием в эту ветку движок несколько дней тестируется  на
живом сервере.
Ветка  "trunk"  содержит  самую  свежую  версию  движка  с  новыми   фичами   и
изменениями. Однако за свежесть  приходится  чем-то  расплачиваться.  Расплатой
является меньшее время тестирования на живых серверах.
А  вот  ветка  "test"  -  для  самых  смелых,  храбрых  и  попросту  говоря   -
безрассудных. Это - копия моей рабочей  ветки.  Она  содержит  то,  над  чем  я
работаю в данный момент. В общем - я даже не гарантирую,  что  чекаут  из  этой
ветки  вообще запустится. Используйте её на свой страх и риск. Я предупредил.

SourceForge
-----------
Так же есть репозиторий на SourceForge:
  git://supernova-ws.git.sourceforge.net/gitroot/supernova-ws/supernova-ws

Архив инсталляции для загрузки - для тех, кто не осилил GIT
  http://sourceforge.net/projects/supernova-ws/files/

Поддержка
---------
Форум поддержки проекта:
  http://forum.supernova.ws/viewforum.php?f=73

"Живые" Вселенные
-----------------
СверхНовая (х1):
  http://supernova.ws

оГейм (x2):
  http://ogame.supernova.ws

Бета (x50):
  http://beta.supernova.ws


Терминология
============
"Сервер" - веб-сервер с установленным PHP, MySQL и xCache
"СН" или "движок" - исполнимый код Проекта "Сверхновая"
"Вселенная"  -  экземпляр  движка,  установленный  на  сервер  и  имеющий  свою
                собственную  отдельну  БД.  Один  сервер   может   поддерживать
                несколько Вселенных
"Топ" - игрок, входящий в первые 5% игроков по статистике


Боевая система
==============
UBEv3
-----
СН  использует  собственную  боевую  систему  UBEv3.  Все  расчеты,  касающиеся
обработки  боя,  унифицированы.  Т.е.  обычный  бой,  симулятор,  удержание   и
уничтожение луны - все они используют один и тот  же  алгоритм  расчета.  В  RR
использовались три разных движка для разных расчетов.

Особенности UBEv3
-----------------
1. Своя система расчета повреждений
2. Свой собственный вариант "скорострела" (НЕ ТАКОЙ, КАК НА ОФФЕ!)
3. Свой алгоритм расчета добычи с планет
4. Полностью рабочие САБы
5. Работает удержание на лунах при задании "Уничтожить"

В UBEv3 НЕТ понятия "скорострела". Вместо него используется  понятие  "залповый
огонь". По функционалу "залповый огонь" и "скорострел" - понятия  одного  ряда.
Но алгоритмы расчета у них РАЗНЫЕ.

Боевая система работает следуюшим образом. Предполагается,  что  оба  флота  (в
случае боя один на один) летят в формации "диск". Что, в целом, логично -  надо
максимизировать   возможность   каждого   корабля   дать   залп.   Залп   флота
распределяется между классами кораблей противника в зависимости от брони (ака -
тоннажа, ака размера). Тоже логично  -  в  большую  цель  легче  попасть.  Щиты
принципиально отличаются от брони тем,  что  щиты  считаются  целиком  по  типу
кораблея, а броня - индивидуально для каждого корабля. Т.е.  что  бы  повредить
один корабль,  сначала  надо  пробить  щиты  по  типу  кораблей.

При выстреле атакующего в противника, против которого у аттакера есть  залповый
огонь, урон модифицируется согласно внутренним таблицам. Залповый  огонь  может
как увеличивать наносимые повреждения, так и уменьшать -  значения  в  таблицах
залпового огня подобраны таким образом, что бы с одной стороны  сделать  каждый
корабль уникальным и применимым в определенных условиях, а с другой  стороны  -
сбалансировать все корабли между собой и не допустить появление суперкораблей.

Обращаю внимание - залповый огонь применяется  сразу  по  щитам.  Дальше  часть
урона поглощается  щитами,  а  если  что-то  прошло  сквозь  щиты  -  наносится
повреждение по броне. А там сравниваем прошедший  урон  с  броней  и  списываем
нужное количество корабликов.

Случайная составляющая
----------------------
Бои в СН имеют случайную составляющую. Т.е. результаты двух проведенных боев  в
одних и тех же начальных условиях могут различаться кардинально. С точки зрения
игрового  мира,  случайная  составляющая  отражает  маневры  кораблей,   работу
пилотов, наводчиков и всего остального экипажа корабля, а так  же  случайности,
присущие реальному миру.

Симулятор
---------
В симуляторе убрана  случайная  составляющая.  Это  позволит  не  пересчитывать
результаты по десять раз, что бы получить примерное представление о  бое,  а  с
первого раза увидеть результат "в нормальных условиях" без влияния случайностей.
Симулятор поддерживает продвинутую систему ссылок. Теперь можно  давать  ссылку
как на результат симуляции, так и на форму с заполненными  входные  данные  для
дальнейших экспериментов

FAQ по боевой системе
---------------------
Q: Что означает в описании корабля Х строка  "Одним  залпом  поражает  КорабльY
ZШтук"?
A: Она означает, что если корабль Х (при отсутсвии бонусов к  щитам/броне/урону
и отсутсвии офицеров) встретится с ZШтук кораблей разновидности КорабльY, то за
один раунд корабль Х уничтожит все корабли противника.
Для кораблей, которых нет в  списке  залпового  огня,  количество  убиваемых
кораблей за раунд равно: (БроняЗащитника + ЩитыЗащитника) / АтакаНападающего.

Q: Корабль Х уничтожил корабли противника, но ответным залпом его самого сбили!
A: А так вполне может быть. Выживаемость корабля Х никто не гарантировал

Q: Как-то странно выбираются цели при залпе...
A: Увы, что бы корректно выбирать цели, необходимо обсчитывать каждый  корабль.
Т.е. во-первых - иметь  индивидуальную  запись  каждого  корабля.  Во-вторых  -
вычислять эффективность удара в зависимости от параметров каждого корабля, т.е.
совершать просмотр  огромного  количества  информации  каждый  ход.  Если  даже
применять всякие алгоритмы оптимизации и сортировки, то  на  величинах  порядка
десятков тысяч кораблей (обычная бойня между топ-флотами) количество вычислений
будет чрезвычайно велико. И это  не  считая  сложности  разработки  более-менее
оптимального алгоритма. Поэтому ради  ускорения  расчетов  приходится  идти  на
сознательное огрубление модели.

Q: Просуммировал нанесенные повреждения, а затем посчитал, сколько должно  было
быть нанесено повреждений. Цифры не совпадают!!!
A: Поскольку применяется достаточно грубая и упрощенная модель (см.  предыдущий
ответ), часть урона может пропасть. Например, если несколько атакующих стреляют
по одним и тем же кораблям и первым залпом  корабли  защитника  уничтожены,  то
остальной урон прийдется на пустое место, т.е.  "пропадет".  Учет  "пропавшего"
урона потребовал бы перерасчета всех оставшихся категорий  кораблей  на  каждой
итерации, т.е.  существенно  увеличил  бы  нагрузку  (эксперимент  такого  рода
проводился). Кроме того, если урон приходится на последние корабли  противника,
часть его все равно пропадет.

Q: Посчитал в симуляторе - СН не смогла убить туеву хучу  кораблей!  Корабль  -
гавон!!!
A: Еще раз - применяется достаточно грубая и  упрощенная  модель  обсчета  боя,
см. пред-предыдущий ответ. В частности, каждый  раунд  количество  уничтоженных
кораблей округляется вниз до  ближайшего  целого.  Т.е.  если  в  одном  раунде
корабль атакующего нанес повреждений после щита на 0.99 кораблей защитник,  это
значение округляется до 0 и в следующем раунде количество кораблей  у  защтника
будет таким же. Грубо говоря, это означает, что в начале раунда  все  уцелевшие
корабли имеют полную броню. В  случае  симулятора,  где  отсутствует  случайная
составляющая, при определенных условиях СН не сможет убить ни  одного  корабля.
Впрочем, на  граничных  случаях  движок  офф-сервера  тоже  ведет  себя  крайне
странно. У каждого движка - свои особенности.

Ракетный удар
-------------
Полностью переписан скрипт ракетной атаки. Основные моменты:
[*] Полностью устранена ошибка с отрицательными защитными строениями после атаки
[*] Полностью устранена ошибка с размножением защитных строений после атаки
[*] Теперь ракетами в принципе можно уничтожить планетарную защиту (раньше  это
было невозможно)
[*] Учитывается уровень вооружений нападающего и уровень брони обороняющегося
[*] Максимально выбирается весь ракетный урон - ранее существенная часть  урона
могла быть потеряна
[*] Полностью переписана логика случайной атаки - когда ракетам не задана цель.
Теперь она ДЕЙСТВИТЕЛЬНО случайная (в рамках предыдущего пункта)
[*] При выборе конкретного сооружения для атаки ракета  бьет  ИСКЛЮЧИТЕЛЬНО  по
выбранному сооружению
[*] Правильно и всегда срабатывают перехватчики
[*] Теперь после атаки можно собирать обломки защитных сооружений  -  защитнику
автоматически добавляется половина стоимости сооружений в металле и четверть  -
в кристаллах
[*] Устранен глюк с многократным подсчетом одной атаки
[*] Расширено  и  дополнено  сообщение  о  результатах  нападаения,  приходящее
защитнику


Миссии
======

Шпионаж
-------
Переписана подсистема шпионажа. Теперь  шпионаж  работает  почти  как  на  оффе
(потому что их  алгоритм  меня  вполне  устраивает).  Если  очень  коротко,  то
работает все примерно так:

1. Эффективный уровень шпионажа (ЭУШ) на миссию определяется по формулам:
   Эффективный уровень шпионажа атакующего:
   Уровень шпионской технологии + Уровень офицера "Шпион" + квадратный корень(количества шпионов в миссии) - 1

   Эффективный уровень шпионажа защитника:
   Уровень шпионской технологии + Уровень офицера "Шпион"
2. Вычисляется разница между ЭУШ атакующего и ЭУШ защитника. Если разница уровней...
   меньше 2 - атакующий видит только ресурсы
   2 и выше - атакующий видит флот на орбите (только флот хозяина планеты! Удержание не видно!)
   3 и выше - атакующий видит защитные сооружения
   5 и выше - атакующий видит постройки
   7 и выше - атакующий видит постройки
3. Шанс (в процентах) обнаружения шпионского флота защитником определяется по формуле:
   К-во зондов * pow(2, ЭУШ защитника - ЭУШ аттакера) * К-во кораблей на орбите / 4
   где pow(2, X) - функция степени двойки, т.е. "2 в степени X".
   Обращаю внимание, что  в  некоторых  случаях  шанс  обнаружения  может  быть
   больше 100% - например при большом флоте на орбите, при  большом  количестве
   кораблей в шпионском флоте,  при  большой  разнице  между  ЭУШ  защитника  и
   аттакующего
4. После вычисления шанс обнаружения сравнивается со случайным числом от  0  до
   99. Если шпионский флот обнаружен - он в полном составе уничтожается (да,  в
   шпионаж все корабли летят со снятым оружием и броней!).

Из вышеописанного алгоритма следует несколько интересных следствий:
1. Количество зондов решает
2. Флот на орбите решает зонды
3. Защититься  от  шпионажа  невозможно,  но   можно   сделать   его   дорогим
   удовольствием. Настолько дорогим, что летать в шпионские миссии  на  равного
   по уровню шпионажа игрока будут только в endgame. Собственно,  для  этого  и
   изменены цифры разницы уровней
4. Посылать количество зондов, некратное квадрату - не имеет смысла. Все  равно
   в расчетах округлится  вниз  до  ближайшего  квадрата,  а  риск  обнаружения
   шпионажа существенно вырастет
5. И уж тем более нет смысла посылать в шпионаж любые корабли кроме зондов
6. Развивай шпионаж с молоду!
7. Офицер "Шпион" - он не зря в условно-шахтерской ветке!


Ролевая система - все, относящееся к ТМ
=======================================
Переписана система начисления опыта, уровней и Темной Материи.

В настоящий момент существует три источника  ТМ:  постройка  зданий,  рейды  на
врагов и экспедиции. По логике игры ТМ  считается  редким  и  ценным  ресурсом,
каждая единица которого должна добываться огромным трудом и вкладываться с умом
и перспективой. Кроме того,  множество  вопросов  вызывает  ограничение  в  150
уровней по экономике. Изменения в ролевой системе призваны устранить  оба  этих
недостатка.

Теперь опыт, необходимый для  получения  в  следующем  уровне  строительства  и
рейдерства растет в геометрической прогрессии. Это означает, что с каждым новым
уровнем получить следующий уровень будет все сложнее и сложнее.

Одновременно снято ограничение в 150 для экономических уровней.

Для экономики прогрессия имеет коэфициент 1,03 с первым членом 50. Это дает нам такой ряд:
  1    50     50    50
  2    52    102   100
  3    53    155   150
  4    55    209   200
  5    56    265   250
  6    58    323   300
  7    60    383   350
  8    61    445   400
  9    63    508   450
 10    65    573   500
 20    88   1344  1000
 30   118   2379  1500
 40   158   3770  2000
 50   213   5640  2500
 60   286   8153  3000
 70   384  11530  3500
 80   517  16068  4000
 90   694  22167  4500
100   933  30364  5000
110  1254  41380  5500
120  1685  56185  6000
130  2264  76081  6500
140  3043 102820  7000
150  4090 138754  7500
160  5497 187048  НЕТ
170  7387 251950  НЕТ
180  9927 339172  НЕТ
190 13342 456392  НЕТ
200 17930 613926  НЕТ
ИТД

Для рейдерства прогрессия имеет коэфициент 1,03 с первым членом 10.
  1   10     10   10
  2   10     20   20
  3   11     31   30
  4   11     42   40
  5   11     53   50
  6   12     65   60
  7   12     77   70
  8   12     89   80
  9   13    102   90
 10   13    115  100
 20   18    269  200
 30   24    476  300
 40   32    754  400
 50   43   1128  500
 60   57   1631  600
 70   77   2306  700
 80  103   3214  800
 90  139   4433  900
100  187   6073 1000
110  251   8276 1100
120  337  11237 1200
130  453  15216 1300
140  609  20564 1400
150  818  27751 1500
160 1099  37410 1600
170 1477  50390 1700
180 1985  67834 1800
190 2668  91278 1900
200 3586 122785 2000
ИТД

В таблице:
Первая колонка - уровень
Вторая колонка - новое количество опыта, необходимое для перехода на  следующий
уровень
Третья колонка - новое  общее  количество  опыта,  необходимое  для  достижения
уровня
Четвертая колонка - старое общее количество опыта, необходимое  для  достижения
уровня

FAQ по новой системе ресурсов
-----------------------------
Q: Теперь, чтоб купить офицеров, придется 800 лет зарабатывать ТМ
A:  Так  и  должно  быть.  Анализ  распределения  офицеров  у  игроков  показал
пародоксальную ситуацию - у более  чем  половины  игроков  были  выкуплены  все
офицеры! Так быть не должно - высокоуровневые офицеры  должны  быть  в  штучных
количествах у топов.

Q: Нужно пересмотреть систему оплаты за обмен ресов на черном рынке - при таком
начислении ТМ, она будет крайне дорогим удовольствием.
A:  Обмен  ресурсов  через  черный  рынок  и  должно   быть   "крайне   дорогим
удовольствием". Пользуйтесь "Биржей обмена ресурсов".

Q: Будет ли по-прежнему добываться ТМ в экспедициях?
A: Да.

Черный рынок
------------
Полностью переписан Черный Рынок. Теперь можно менять ТМ на  ресурсы  (Торговец
Ресурсами), продавать несколько типов  кораблей  за  одну  транзакцию  (Скупщик
флота). Так же добавлен "Продавец кораблей", где можно  выкупить  ранее  кем-то
проданные корабли


Офицеры
=======
Полностью  переработана  система  офицеров.  Основное  новвоведение  -  офицеры
разбиты на две почти независимые подветки - "шахтерскую" и "рейдерскую".

"Шахтерская" ветка начинается с Геолога и включает  Энергетика,  Карго-мастера,
Архитектора, Шпиона, Координатора. "Рейдерская" ветка начинается с  Адмирала  и
включает Конструктора, Академик, Фортификатор, Защитника, Навигатора.

Открытие второго офицера в ветке требует 5 уровней первого офицера, а каждого -
следующего - по 5 уровней двух предыдущих (каждый раз пары разные).
Топ-офицеры  Разрушитель  и  Ассасин  кроме  полного  открытия  своей  подветки
("шахтерской" и "рейдерской" соответственно) требуют  открытия  соседней  ветки
примерно до половины


Система рейтингования
=====================
Добавлена статистика по ресурсам
Полностью блокирована возможность прокачки сильных игроков слабыми

Защита "начинающих" и "слабых" игроков
--------------------------------------
Полностью переписан алгоритм защиты игроков от нападения более сильного игрока.

Возьмем двух игроков - Игрок1 и Игрок2. Если у Игрока1 количество  очков  общей
статистики в game_noob_factor (по умолчанию - 5) раз больше, чем у Игрока2,  то
Игрок1 по  отношению  к  Игроку2  считается  "сильным"  игроком,  а  Игрок2  по
отношению к Игроку1  считается  "слабым"  игроком.  "Слабые"  игроки  полностью
защищены от агрессивных действий со стороны "сильных" - на них нельзя нападать,
нельзя шпионить, нельзя уничтожать луну итд.
Установка game_noob_factor в 0 отключает защиту "слабых" игроков

Игроки, у которых количество очков в общей статистике  не  превышает  превышает
game_noob_points  (по  умолчанию  5000)   считаются   "начинающими"   игроками.
На "начинающего" игрока может напасть только другой "начинающий"  (естественно,
с учетом соотношения "слабый-сильный", см. выше). "Начинающий"  может  нападать
на кого угодно.
Установка game_noob_points в 0 отключает защиту "начинающих" игроков


Партнерская программа
=====================
Написан  с  нуля  модуль  Партнерской  программы.   Каждому   игроку   выдается
персонализированная ссылка, персонализированный  баннер  и  персонализированный
юзербар, а так же коды для  размещения  всего  этого  добра  на  форумах  и/или
домашних страничках. Если на сервер по ссылке  приходит  новый  пользователь  и
регестрируется  на  сайте,  приведший  его  игрок  получает  10%  от  всех  ТМ,
заработанных новым пользователем (включая дополнительные начисления)


Модуль новостей
===============
Добавлен полноценный модуль новостей, доступный по  ссылке  "Новости"  в  левом
меню. Доступ к управлению новостями админы получают по той же  ссылке  -  права
определяются по authlevel
К пункту меню "Новости" добавлен индикатор непрочитанных сообщений
Добавлена дополнительная строка в админском интерфейсе, в которую  можно  вбить
URL с подробностями новости. URL добавится в конце новости в  виде  гиперссылки
со слова "Подробнее..." из текста новости


Альянсы
=======
Полностью  переписан  модуль  управления   Альянсами.   Кардинально   сокращено
количество прав, упрощен интерфейс, переписана система заявок и так далее.


Друзья
======
Полностью переписан модуль "Друзей"


Закладки
========
Полностью переписана система закладок. Теперь  закладки  хранятся  в  отдельной
таблице и не захламляют данные пользователя.  Кроме  того,  такое  расположение
закладок повышает устойчивость движка к SQL-injection.
Полностью переделано редактирование закладок. Добавлена возможность копирования
закладок


Сообщения
==========
Оптимизированы запросы к БД. Добавлены индексы к  таблице  messages.
Добавлена возможность просмотра отправленных сообщений (только тех, которые  не
удалил адресат)
Теперь можно сразу из отчета  шпиона  запускать  симуляцию  боя  по  полученным
разведданным
Перекрашены сообщения. Цвета заголовков теперь соответствуют  цветам  сообщений
и, в свою очередь, синхронизированны с раскраской флотов - там, где  это  имеет
смысл


Чат
===
Код чата существенно переработан, что бы исключить DDoS сервера.
Сообщения админа в чате выделяются пурпурным цветом, что бы отметить  их  среди
сообщений обычных пользователей
Добавлена  возможность  настраивать  таймаут  чата  через  интерфейс   настроек
Вселенной (раздел "Настройки чата"/"Таймаут  по  неактивности").  Значение  "0"
означает, что таймаут отключен (не рекомендуется, потому что  при  неправильных
настройках сервера большое одновременное количество запросов может  привести  к
DoS)



Интерфейс
=========

Логин и регистрация
-------------------
Полностью переделаны экраны логина и регистрации
Полностью переделана подсистема восстановления забытого пароля
Незалогиненные пользователи имеют  возможность  предварительно  ознакомиться  с
сервером: почитать новости, просмотреть настройки сервер, статистику игроков  и
список банов, связаться с администраторами, ознакомится  с  правилами  и  ЧаВо,
сходить на форум

Вселенная
---------
Серьезно переработан код "Вселенной" (бывш. "Галактика"). Шаблоны  вытащены  из
кода и перенесены в TPL-файл. Поп-апы (инфо о планетах, лунах итд)  вынесены  в
отдельные JS-процедуры, что в отдельных случаях позволило  уменьшить  финальный
размер страницы в два-три раза, а количество запросов к БД снизить от  двух  до
десяти (!) раз - особенно в системе, густо заселенной одним игроком. Библиотека
попапов изменена с overlib на  jQuery  -  это  дало  отличную  кросс-браузерную
совместимость и устранение проблем с попапами в ИЕ. В целом  новая  "Вселенная"
существенно меньше грузит сервер и работает на клиенте гораздо быстрее.

Ракеты теперь отправляются через AJAX без обновления страницы

На  изображении  вражеских  планет,  на  которые  летят  флоты  игрока   теперь
отображается соответствующая иконка и при наведении всплывает попап со  списком
всех входящих кораблей

На обломках показывается общее количество ресурсов

На иконке обломков отображается количество переработчиков пользователя, летящих
на эти обломки

Переработка поля обломков
-------------------------
Полностью переписан интерфейс переработки  обломков.  Он  учитывает  количество
переработчиков, уже  отправленных  на  поле  обломков  и  позволяет  эффективно
собирать обломки с нескольких планет

Обзор планеты
-------------
Полностью переработана страница "Обзор планеты".
1. Список планет  с  картинками  перенесен  из  таблицы  направо.  На  картинки
   добавлены иконки: активного строительства, активного исследования,  активной
   верфи, индикатор прибывающего  собственного  флота,  индикатор  прибывающего
   враждебного флота, статус застройки  планеты.  Так  же  указывается  текущее
   строительство на каждой планете и таймер обратного отсчета
2. Полностью переработан график движения  флотов.  Теперь  отдельно  выделяются
   такие  события,  как  "Прибытие",  "Возвращение"  и   "Окончание   задания".
   Отделяются события для текущей выбранной планеты и для остальных
3. Добавлены три таймера обратного отсчета для  строительства,  исследований  и
   верфи. Таймер верфи и таймер зданий поддерживают очередь построек.
4. Статистика игрока и баннеры перенесены на страницу "Император"
Полностью переписано управление планетой

Строительство зданий
--------------------
Новый интерфейс строительства зданий  -  более  компактный  и  удобный
Немного изменен  порядок  зданий  на  странице  постройки.  Теперь  все  здания
сгруппированы  по  типам:  первая  линейка  -  добывающие,  вторая  линейка   -
производящие, третья линейка - склады. На луне и/или при не всех доступных  для
постройки зданиях порядок пока может меняться
Дополнительно показываются остатки ресурсов с  учетом  прибывающих  на  планету
флотов с грузом
Написанная с нуля очередь построек

Флоты
-----
Полностью переработана страница флотов. Добавлено цветовое кодирование в списке
флотов
Добавлены  слайдбары  для  выбора  количества  кораблей.  На  первой   странице
указываются предварительные параметры флота (грузоподъемность,  скорость,  если
указана точка назначения - время полета  и расход дейтрия)
Команда на возвращение флота теперь не ведет на промежуточную страницу, а сразу
обрабатывается подсистемой флотов

Своз ресурсов
-------------
Добавлена новая возможность - свезти ресурсы с  остальных  планет  на  текущую.
Игрок выбирает колонии и луны, с которых нужно свезти  ресурсы  на  текущую,  а
движок автоматически рассчитает  нужное  количество  транспортов,  загрузит  их
ресурсами и отправит флоты.
В перевозке ресурсов участвуют только транспортные  корабли:  Малый  транспорт,
Большой транспорт и Супертранспорт.  Корабли  загружаются  в  порядке  убывания
емкости трюма
Есть возможность выбирать все ресурсы одного типа на всех планетах; все ресурсы
на одной планете; все ресурсы на всех планетах
Возможность доступна из левого меню "Флоты"  через  кнопку  "Свезти  ресурсы".

Империя
-------
На изображения планет добавлены иконки, как на странице  "Обзор  планеты"  (см.
выше).
Убрано многократно дублирующееся перечисление технологий, идентичных  для  всех
планет.
Добавлена дополнительная колонка, в которой суммируются данные по всей Империи.
В списке построек отображаются строящиеся/уничтожаемые здания
В списке кораблей отображаются строящиеся и прилетающие корабли
В списке защитных сооружени отображаются строящаяся защита

Император
---------
Новая страница. Содержит небольшой блок новостей, блок статистики игрока и блок
баннеров/юзербаров

Мировые константы
-----------------
Новая страница. Показывает текущие настройки Вселенной пользователям

Система отпусков
----------------
Переписана с нуля система отпусков.  Теперь  работает  опция  "Отключить  режим
отпуска". На пользовательскую страницу настроек добавлен  таймер,  показывающий
минимальный срок отпуска, если игрок уйдет в отпуск сейчас

Google AdSense
--------------
Внизу левого меню добавлен блок для  вставки  рекламы  от  Гугля.  В  принципе,
ничего не мешает вставить туда рекламу от любого  другого  рекламного  сайта  -
соответствующий HTML-код задается в настройках Вселенной

Прочее
------
Страницы статистики, списка банов, списка контаков Вселенной,  списка  настроек
доступны для просмотра незалогиненным, находящимся в отпуске и забаненных


Локализация
===========
СН рахрабатывается  на  русском  языке.  В  27  релизе  добавлена  англоязычная
локализация и включена возможность смены языков пользователем

Существенно переработаны файлы  локализаций:  убраны  неиспользуемые  файлы,  а
мелкие файлы, содержащие меньше десятка строк слиты с соответствующими файлами

Добавлены полноценная информация о локализации  (файл  language.mo  в  каталоге
локализации)


Установка и администрирование
=============================
В отличие от RR СН может размещаться на веб-сервере на любом уровне вложенности
каталогов

Добавлена возможность автоматического  обновления  статистики  (настройка  пока
только  через  БД).  Автоматическое  обновление  статистики   производится   по
расписанию через AJAX

Полностью переписан модуль обновления статистики.  Максимум  вычислений  теперь
проводятся на стороне MySQL сервера без необходимости перекачивать данные в PHP
и обратно. Обновление статистики завернуто в транзакции. Все эти меры привели к
тому, что скорость обновления статистики на сервере с 500  аккаунтами  (P4  3,0
GHz, 2 Gb RAM) составляет меньше секунды!

Полностью переписан код баннерилки. Добавлена возможность включить РО при бане.
При разбане режим РО остается, но разрешается из него выйти

С нуля написана  страница  добавления/удаления  ТМ.  Добавлена  запись  событий
начисления/снятия   ТМ   в   таблицу   logs   для   предотвращения    возможных
злоупотреблений

Полностью переработана система внутренних логов сообытий. События сохраняются с
двумя  компонентами  -  пригодной  для  чтения  человеком  напрямую  из  БД   и
machine-readable, предназначенной для разбора встроенным  парсером.  Во  второй
компоненте  сохраняется  backtrace,  переменные   окружения   ($_GET,   $_POST,
$_SERVER,  $_COOKIE),  логи  запросов,  а  так  же  любые  другие  по   желанию
разработчика.
Предусмотрено два уровня событий - "Информационное сообщение" и  "Ошибка".  Так
же система событий имеет развитую систему кодов ошибок
Встроенный парсер  позволяет  просматривать  подробности  о  каждой  ошибке  на
отдельной странице.
Игрокам показывается ID ошибки в БД, а не  её  порядковый  номер.  Это  заметно
ускоряет поиск нужной записи об ошибке

Уничтожение планет с компенсацией
---------------------------------
Добавлена возможность  уничтожения  планет  игроков  с  компенсацией  стоимости
зданий, строений и ресурсов


Персонализация
==============
Теперь администраторы сторонних серверов могут задавать скин, темплейт  и  язык
по умолчанию. Это сделано для поддержки авторских разработок при обновлении  из
репозитория

Администраторы так же могут конфигурировать основные ссылки - ссылки  на  ЧаВо,
на правила, на форум и на страницу  покупки  ТМ.  В  случае  отсутствии  ссылок
соответствующие пункты и ссылки скрываются


Прочее
======
Максимальное количество колоний у игрока по умолчанию увеличено до 9


Внутренние изменения
====================

Очереди
-------
Полностью переписана очередь построек
Исправлена ошибка, позволяющая при наличии выше в  очереди  на  верфи  медленно
строящегося юнита использовать его время постройки для создания более  быстрого
юнита  путем  добавления   последнего   в   очередь.   Например,   эта   ошибка
использовалась для быстрой постройки множества ракет
Унифицированы алгоритмы и файлы постройки флота и защиты. Это должно  полностью
снять проблемы с отрицательными ресурсами после верфи  и  с  постройкой  лишних
единиц флота/защиты на верфях

Менеджер флотов в полете
------------------------
Полностью  переписан  менеджер  летящих  флотов  -  теперь   рядно-блокирующий,
тразакционный и кэширующий! Обновленный код на порядок  уменьшает  нагрузку  на
сервер за счет встроенной системе кэширования запросов b перехода  c  табличной
блокировки на рядную.
Система "событий" гарантирует корректный порядок обработки флотов (с  точностью
до секунды - предела текущей  организации  таблиц).  Целостность  и  валидность
результатов обеспечена добавлением  транзакций.  Всё  это  позволило  уменьшить
дискретизацию обработки  флотов  до  4х  секунд  на  серверах  с  300+  онлайна
(предыдущий менеджер при онлайне порядка 200 человек и дискретизацией 12 секунд
примерно через два часа работы "выбивал" MySQL сервер). При этом среднее  время
ожидания блокировки не превышает 250 мс.

Система темплейтов
------------------
Добавлен движок рендеринга темплейтов от phpBB3. Движок доработан  до  обратной
совместимости с темплейтами XNova.
В темплейтах можно указывать префикс "L_" что бы взять  переменную  из  массива
$lang и не  нужно  целиком  передавать  в  массив  $lang  в  процедуру  разбора
темплейтов. Так же можно  использовать  локализованные  значения  в  одномерных
массивах. Например, $lang['tech'][401] в темплейте превратится в {L_tech[401]}.
Поддерживаются так же строковые индексы массивов.
В темплейтах можно указывать префикс "C_",  что  бы  использовать  значение  из
конфигурации Вселенной. Не работает в условных операторах.
В темплейтах  можно  указывать  префикс  "D_",  что  бы  использовать  значения
PHP-констант

JS библиотека таймеров
----------------------
Написана  с  нуля  универсальная  система  внутриигровых  таймеров  на  стороне
клиента. Корректно обрабатываются нажатие кнопки Back в браузере (через  AJAX).
Корреткно обрабатывается  рассинхронизация  часов  между  клиентом  и  сервером
(включая часовые пояса)

Баннер и юзербар
----------------
Полностью  переписана  система  генерации   баннеров/юзербаров.   Унифицированы
процедуры их генерации,  слиты  в  один  файл  процедур  и  один  файл-враппер,
вынесены PHP-файлы из каталога scripts в соответствующие места.

Автоматическое обновление
-------------------------
Написан с нуля модуль автоматического обновления структуры БД

Логи ошибок и событий
---------------------
Полностью  переделана  система  логов.  Кроме  ошибок  в  логи  теперь  пишутся
отдельные   события   (подробнее   -   html/developer.html).   Таблица    логов
переформатирована для лучшего чтения человеком  в  дампе.  Добавлено  несколько
machine-readable полей для сохранения более полной информации о событии

xCache
------
Движок  теперь   поддерживает   xCache.   Использование   xCache   настоятельно
рекомендуется - это заметно разгрузит сервер и уменьшит количество обращений  к
БД. Хотя движок может работать и без кэшера, в дальнейшем СН все  больше  будет
оптимизироваться для использование opcode-cacher

Sypex Dumper
------------
В дистрибутив добавлена копия Sypex Dumper v2.0.8 (freeware)  для  создания
резервных копий (и, естественно, их восстановления)

Прочее
------
Закрыты все обнаруженные дыры в  безопасности  (SQL-injection  через  параметры
страницы) на страницах, доступных пользователям.  Так  же  полностью  исключена
возможность начисления ТМ посредством взлома извне и изменение  прав  отдельных
игроков

Офицеры отвязаны от конкретных цифр и привязаны к константам-идентификаторам

Удалено множество лишних файлов

Таблицы 'lunas' и 'galaxy' больше  не  используются.  Вся  их  функциональность
перенесена в таблицу 'planets'

Шаблоны даты и времени везде заменены константами.

Все deprecated функции заменены более современными аналогами


Документация
============
Вся документация и сопроводительные файлы находятся в каталоге "docs"  в  корне
движка

Лицензия (на английском):
  /docs/license.txt

Документация на проект (этот файл, на русском):
  /docs/readme.txt

История изменения для пользователей (на русском):
  /docs/changelog.txt

Инструкции по установке (на русском):
  /docs/install.txt

Документация для администраторов и разработчиков (на русском):
  /docs/html/developer.html

История изменений для администраторов и разработчиков (на русском):
  /docs/changelog_dev.txt

Планы развития (на русском):
  /docs/todo.txt

Coding Gudelines для разработчиков (на английском):
  /docs/html/coding-guidelines.html

Беллитризированный внутриигровая предыстория (на русском):
  /docs/SuperNova - All you didn't want to know but forced to.docx


Copyright
=========
Сверхновая copyright (c) 2009-2011 Gorlum для http://supernova.ws
Project "SuperNova.WS" copyright (c) 2009-2011 by Gorlum for http://supernova.ws

Based on xNova RageRepack v226

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Updated: 2011-03-15 01:40 Project "SuperNova.WS" Release 27
